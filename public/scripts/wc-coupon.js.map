{"version":3,"file":"/scripts/wc-coupon.js","mappings":"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","sources":["webpack://sage/./resources/scripts/components/message.js","webpack://sage/./resources/scripts/wc-coupon.js"],"sourcesContent":["function message() {\n    $('.woocommerce-error .btn-close, .woocommerce-info .btn-close, .woocommerce-message .btn-close').click(function () {\n        $(this).parent().fadeOut();\n    })\n}\n\nexport {message};\n","import {message} from \"./components/message\";\n\n(function ($) {\n    \"use strict\";\n\n    function getUrlParameter(name) {\n        name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n        var regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)');\n        var results = regex.exec(window.location.search);\n        return results === null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '));\n    }\n\n    function updateUrlParameter(param) {\n        let currentUrl = window.location.href;\n\n        let newUrl;\n        if (currentUrl.includes('?')) {\n            newUrl = currentUrl.split('?')[0] + `?${param}`;\n        } else {\n            newUrl = currentUrl + `?${param}`;\n        }\n\n        window.history.pushState({}, '', newUrl);\n    }\n\n    function removeUrlParameter(param) {\n        var url = new URL(window.location.href);\n        url.searchParams.delete(param);\n        window.history.replaceState({}, document.title, url.toString());\n    }\n\n    let couponTrigger = $('.woocommerce-form-coupon-toggle .showcoupon');\n\n    setTimeout(function () {\n        if (getUrlParameter('growtype_wc_coupon_form_visible') === '1') {\n            couponTrigger.first().click();\n        }\n    }, 500)\n\n    /**\n     * Coupon url params\n     */\n    couponTrigger.click(function () {\n        if ($('.woocommerce-form-coupon').is(':visible')) {\n            removeUrlParameter('growtype_wc_coupon_form_visible');\n        } else {\n            updateUrlParameter('growtype_wc_coupon_form_visible=1');\n        }\n    });\n\n    function applyCoupon() {\n        jQuery('.e-discount-trigger').click(function () {\n            jQuery(this).fadeOut(function () {\n                jQuery('.b-coupon').fadeIn();\n            });\n        });\n    }\n\n    applyCoupon();\n\n    jQuery(\"body\").on('applied_coupon', function (event, coupon, data) {\n        $('.woocommerce-form-coupon-content .woocommerce-message').remove();\n        $('.woocommerce-form-coupon-content').append('<div class=\"woocommerce-message\">' + data.message + '</div>');\n\n        setTimeout(function () {\n            $('.woocommerce-form-coupon-content').find('.woocommerce-message').fadeOut().promise().done(function () {\n                $(this).remove();\n            });\n        }, 3000);\n\n        setTimeout(function () {\n            applyCoupon();\n        }, 1000)\n\n        /**\n         * Init message close click\n         */\n        message();\n    });\n\n    jQuery(\"body\").on('applied_coupon_in_checkout', function (event, coupon) {\n        console.log('applied_coupon_in_checkout');\n\n        /**\n         * Init message close click\n         */\n        message();\n    });\n\n    jQuery(\"body\").on('update_checkout', function (event, coupon) {\n        console.log('update_checkout');\n    });\n\n    jQuery(\"body\").on('updated_checkout', function (event, coupon) {\n        console.log('updated_checkout');\n    });\n\n    jQuery(\"body\").on('removed_coupon', function (event, coupon) {\n        console.log('removed_coupon');\n    });\n\n    jQuery(\"body\").on('updated_wc_div', function (event, coupon) {\n        console.log('updated_wc_div');\n    });\n\n    $(document.body).on('checkout_error', function () {\n        console.log('checkout_error');\n    });\n\n    $(document.body).on('woocommerce-applied_coupon-in_checkout', function (event, response) {\n        console.log('woocommerce-applied_coupon-in_checkout');\n    });\n\n    $('.coupon-form button[name=\"apply_coupon\"]').on('click', function () {\n        console.log('apply_coupon submit')\n    });\n\n    jQuery(\"body\").on('updated_cart_totals', function () {\n        console.log('updated_cart_totals')\n        applyCoupon();\n    });\n\n    $(document.body).on('click', 'button[name=\"apply_coupon\"]', function (e) {\n        e.preventDefault();\n        var form = $(this).closest('form');\n        var coupon_code = form.find('input[name=\"coupon_code\"]').val();\n\n        var data = {\n            'action': 'growtype_wc_apply_coupon_custom',\n            'security': wc_checkout_params.apply_coupon_nonce,\n            'coupon_code': coupon_code\n        };\n\n        removeUrlParameter('growtype_wc_coupon_form_visible');\n\n        $.ajax({\n            type: 'POST',\n            url: growtype_wc_ajax.url,\n            data: data,\n            success: function (response) {\n                if (response.success) {\n                    $(document.body).trigger('update_checkout');\n                    $(document.body).trigger('applied_coupon', [\n                        coupon_code,\n                        response.data\n                    ]);\n                } else {\n                    $(document.body).trigger('apply_coupon_failed', [\n                        coupon_code,\n                        response.data\n                    ]);\n                }\n            },\n            error: function () {\n                $(document.body).trigger('apply_coupon_failed', [\n                    coupon_code,\n                    {error: 'Ajax error occurred'}\n                ]);\n            }\n        });\n    });\n\n    $(document.body).on('apply_coupon_failed', function (event, coupon_code, data) {\n        $('.woocommerce-form-coupon-content .woocommerce-message').remove();\n        $('.woocommerce-form-coupon-content').append('<div class=\"woocommerce-message woocommerce-error\">' + data.message + '</div>');\n\n        setTimeout(function () {\n            $('.woocommerce-form-coupon-content').find('.woocommerce-message').fadeOut().promise().done(function () {\n                $(this).remove();\n            });\n        }, 3000);\n\n        /**\n         * Init message close click\n         */\n        message();\n    });\n})(jQuery);\n"],"names":["message","$","click","this","parent","fadeOut","removeUrlParameter","param","url","URL","window","location","href","searchParams","history","replaceState","document","title","toString","couponTrigger","applyCoupon","jQuery","fadeIn","setTimeout","name","replace","results","RegExp","exec","search","decodeURIComponent","getUrlParameter","first","newUrl","currentUrl","is","includes","split","concat","pushState","on","event","coupon","data","remove","append","find","promise","done","console","log","body","response","e","preventDefault","coupon_code","closest","val","wc_checkout_params","apply_coupon_nonce","ajax","type","growtype_wc_ajax","success","trigger","error"],"sourceRoot":""}